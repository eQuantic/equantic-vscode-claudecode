<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Chat</title>
    <style>
        /* Claude Theme Variables */
        [data-theme=claude],
        [data-theme=claude][data-mode=light] {
            --accent-brand: 15 63.1% 59.6%;
            --accent-main-000: 15 55.6% 52.4%;
            --accent-main-100: 15 55.6% 52.4%;
            --accent-main-200: 15 63.1% 59.6%;
            --accent-main-900: 0 0% 0%;
            --accent-pro-000: 251 34.2% 33.3%;
            --accent-pro-100: 251 40% 45.1%;
            --accent-pro-200: 251 61% 72.2%;
            --accent-pro-900: 253 33.3% 91.8%;
            --accent-secondary-000: 210 73.7% 40.2%;
            --accent-secondary-100: 210 70.9% 51.6%;
            --accent-secondary-200: 210 70.9% 51.6%;
            --accent-secondary-900: 211 72% 90%;
            --bg-000: 0 0% 100%;
            --bg-100: 48 33.3% 97.1%;
            --bg-200: 53 28.6% 94.5%;
            --bg-300: 48 25% 92.2%;
            --bg-400: 50 20.7% 88.6%;
            --bg-500: 50 20.7% 88.6%;
            --border-100: 30 3.3% 11.8%;
            --border-200: 30 3.3% 11.8%;
            --border-300: 30 3.3% 11.8%;
            --border-400: 30 3.3% 11.8%;
            --danger-000: 0 61.4% 22.4%;
            --danger-100: 0 58.6% 34.1%;
            --danger-200: 0 58.6% 34.1%;
            --danger-900: 0 50% 95%;
            --oncolor-100: 0 0% 100%;
            --oncolor-200: 60 6.7% 97.1%;
            --oncolor-300: 60 6.7% 97.1%;
            --text-000: 60 2.6% 7.6%;
            --text-100: 60 2.6% 7.6%;
            --text-200: 60 2.5% 23.3%;
            --text-300: 60 2.5% 23.3%;
            --text-400: 51 3.1% 43.7%;
            --text-500: 51 3.1% 43.7%;
        }

        [data-theme=claude][data-mode=dark] {
            --accent-brand: 15 63.1% 59.6%;
            --accent-main-000: 15 55.6% 52.4%;
            --accent-main-100: 15 63.1% 59.6%;
            --accent-main-200: 15 63.1% 59.6%;
            --accent-main-900: 0 0% 0%;
            --accent-pro-000: 251 84.6% 74.5%;
            --accent-pro-100: 251 40.2% 54.1%;
            --accent-pro-200: 251 40% 45.1%;
            --accent-pro-900: 250 25.3% 19.4%;
            --accent-secondary-000: 210 71.1% 62%;
            --accent-secondary-100: 210 70.9% 51.6%;
            --accent-secondary-200: 210 70.9% 51.6%;
            --accent-secondary-900: 210 55.9% 24.6%;
            --bg-000: 60 2.1% 18.4%;
            --bg-100: 60 2.7% 14.5%;
            --bg-200: 30 3.3% 11.8%;
            --bg-300: 60 2.6% 7.6%;
            --bg-400: 60 3.4% 5.7%;
            --bg-500: 60 3.4% 5.7%;
            --border-100: 51 16.5% 84.5%;
            --border-200: 51 16.5% 84.5%;
            --border-300: 51 16.5% 84.5%;
            --border-400: 51 16.5% 84.5%;
            --danger-000: 0 73.1% 66.5%;
            --danger-100: 0 58.6% 34.1%;
            --danger-200: 0 58.6% 34.1%;
            --danger-900: 0 23% 15.6%;
            --oncolor-100: 0 0% 100%;
            --oncolor-200: 60 6.7% 97.1%;
            --oncolor-300: 60 6.7% 97.1%;
            --text-000: 48 33.3% 97.1%;
            --text-100: 48 33.3% 97.1%;
            --text-200: 50 9% 73.7%;
            --text-300: 50 9% 73.7%;
            --text-400: 48 4.8% 59.2%;
            --text-500: 48 4.8% 59.2%;
        }

        @media (prefers-color-scheme: dark) {
            [data-theme=claude] {
                --accent-brand: 15 63.1% 59.6%;
                --accent-main-000: 15 55.6% 52.4%;
                --accent-main-100: 15 63.1% 59.6%;
                --accent-main-200: 15 63.1% 59.6%;
                --accent-main-900: 0 0% 0%;
                --accent-pro-000: 251 84.6% 74.5%;
                --accent-pro-100: 251 40.2% 54.1%;
                --accent-pro-200: 251 40% 45.1%;
                --accent-pro-900: 250 25.3% 19.4%;
                --accent-secondary-000: 210 71.1% 62%;
                --accent-secondary-100: 210 70.9% 51.6%;
                --accent-secondary-200: 210 70.9% 51.6%;
                --accent-secondary-900: 210 55.9% 24.6%;
                --bg-000: 60 2.1% 18.4%;
                --bg-100: 60 2.7% 14.5%;
                --bg-200: 30 3.3% 11.8%;
                --bg-300: 60 2.6% 7.6%;
                --bg-400: 60 3.4% 5.7%;
                --bg-500: 60 3.4% 5.7%;
                --border-100: 51 16.5% 84.5%;
                --border-200: 51 16.5% 84.5%;
                --border-300: 51 16.5% 84.5%;
                --border-400: 51 16.5% 84.5%;
                --danger-000: 0 73.1% 66.5%;
                --danger-100: 0 58.6% 34.1%;
                --danger-200: 0 58.6% 34.1%;
                --danger-900: 0 23% 15.6%;
                --oncolor-100: 0 0% 100%;
                --oncolor-200: 60 6.7% 97.1%;
                --oncolor-300: 60 6.7% 97.1%;
                --text-000: 48 33.3% 97.1%;
                --text-100: 48 33.3% 97.1%;
                --text-200: 50 9% 73.7%;
                --text-300: 50 9% 73.7%;
                --text-400: 48 4.8% 59.2%;
                --text-500: 48 4.8% 59.2%;
            }
        }

        :root {
            --font-fallback-serif: Georgia, "Times New Roman", Times, serif;
            --font-fallback-sans: system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --font-fallback-monospace: Menlo, Monaco, monospace, monospace;
            --font-mono: var(--font-jetbrains), var(--font-fallback-monospace);
            --font-ui: var(--font-styrene-b), var(--font-fallback-sans);
            --font-ui-serif: var(--font-copernicus), var(--font-fallback-serif);
            --font-claude-response: var(--font-tiempos), var(--font-fallback-serif);
        }

        body {
            font-family: var(--font-ui, var(--font-fallback-sans));
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: hsl(var(--bg-100));
            color: hsl(var(--text-000));
            overflow: hidden;
            /* Prevent body scroll */
        }

        /* Apply Claude theme */

        .chat-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            /* Allow flex item to shrink */
            overflow: hidden;
        }

        /* Messages container - scrollable area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 0;
            /* Allow flex item to shrink */
        }

        .message {
            max-width: 90%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-in;
        }

        .message.user {
            align-self: flex-end;
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            padding: 12px 16px;
            border-radius: 18px 18px 4px 18px;
            margin-bottom: 8px;
        }

        .message.assistant {
            align-self: flex-start;
            background: var(--vscode-input-background);
            border: 1px solid var(--vscode-input-border);
            padding: 12px 16px;
            border-radius: 18px 18px 18px 4px;
            margin-bottom: 8px;
        }

        .message-meta {
            font-size: 0.75em;
            opacity: 0.7;
            margin-bottom: 4px;
        }

        /* Streaming Cards */
        .streaming-card {
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-panel-border);
            border-radius: 8px;
            margin: 8px 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card-header {
            background: var(--vscode-titleBar-activeBackground);
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .card-content {
            padding: 12px;
        }

        /* Code Snippets */
        .code-snippet {
            background: var(--vscode-textCodeBlock-background);
            border: 1px solid var(--vscode-panel-border);
            border-radius: 6px;
            margin: 8px 0;
            overflow: hidden;
        }

        .code-snippet pre {
            margin: 0;
            padding: 12px;
            overflow-x: auto;
            font-family: var(--vscode-editor-font-family);
            font-size: var(--vscode-editor-font-size);
        }

        .code-header {
            background: var(--vscode-badge-background);
            color: var(--vscode-badge-foreground);
            padding: 4px 8px;
            font-size: 0.8em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-button {
            background: transparent;
            border: none;
            color: var(--vscode-badge-foreground);
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
        }

        .copy-button:hover {
            background: var(--vscode-button-hoverBackground);
        }

        /* Input Area - Fixed at bottom */
        .input-area {
            flex-shrink: 0;
            /* Never shrink */
            background: hsl(var(--bg-100));
            border-top: 1px solid hsl(var(--bg-300));
            padding: 16px;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Footer Actions */
        .footer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            gap: 12px;
        }

        .action-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: hsl(var(--bg-200));
            border: 1px solid hsl(var(--bg-300));
            border-radius: 8px;
            cursor: pointer;
            color: hsl(var(--text-300));
        }

        .action-button.transition-colors {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(.4, 0, .2, 1);
            transition-duration: .15s;
        }

        .action-button:hover {
            background: hsl(var(--bg-300));
            color: hsl(var(--text-000));
        }

        .search-button {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: hsl(var(--bg-200));
            border: 1px solid hsl(var(--bg-300));
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: hsl(var(--text-300));
            font-size: 14px;
        }

        .search-button:hover {
            background: hsl(var(--bg-300));
            color: hsl(var(--text-000));
        }

        .model-selector {
            position: relative;
            display: flex;
            align-items: center;
            background: hsl(var(--bg-200));
            border: 1px solid hsl(var(--bg-300));
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .model-selector:hover {
            background: hsl(var(--bg-300));
        }

        .model-select {
            background: transparent;
            border: none;
            color: hsl(var(--text-000));
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            appearance: none;
            outline: none;
            padding-right: 8px;
        }

        .model-selector svg {
            pointer-events: none;
            color: hsl(var(--text-400));
        }

        .upload-button {
            background: hsl(var(--accent-main-200));
            color: hsl(var(--oncolor-100));
            border-color: hsl(var(--accent-main-200));
        }

        .upload-button:hover {
            background: hsl(var(--accent-main-100));
            border-color: hsl(var(--accent-main-100));
        }

        .input-container {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            background: hsl(var(--bg-000));
            color: hsl(var(--text-000));
            border: 1px solid hsl(var(--bg-300));
            border-radius: 20px;
            padding: 12px 16px;
            resize: none;
            min-height: 20px;
            max-height: 120px;
            font-family: inherit;
            font-size: inherit;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: hsl(var(--accent-main-200));
            box-shadow: 0 0 0 2px hsla(var(--accent-main-200), 0.2);
        }

        .message-input::placeholder {
            color: hsl(var(--text-400));
        }

        .send-button {
            background: hsl(var(--accent-main-200));
            color: hsl(var(--oncolor-100));
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .send-button:hover {
            background: hsl(var(--accent-main-100));
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Workspace Context */
        .workspace-context {
            background: hsl(var(--bg-200));
            color: hsl(var(--text-300));
            padding: 8px 12px;
            margin: 8px 16px;
            border-radius: 6px;
            font-size: 0.85em;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            border: 1px solid hsl(var(--bg-300));
        }

        .context-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Thinking Animation */
        .thinking {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--vscode-editor-inactiveSelectionBackground);
            border-radius: 16px;
            margin: 8px 0;
        }

        .thinking-dots {
            display: flex;
            gap: 2px;
        }

        .thinking-dots span {
            width: 6px;
            height: 6px;
            background: var(--vscode-editor-foreground);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .thinking-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .thinking-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Syntax Highlighting */
        .keyword {
            color: var(--vscode-symbolIcon-keywordForeground, #569cd6);
        }

        .string {
            color: var(--vscode-symbolIcon-stringForeground, #ce9178);
        }

        .comment {
            color: var(--vscode-symbolIcon-colorForeground, #6a9955);
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 20px;
            background: hsl(var(--bg-100));
            overflow-y: auto;
        }

        .welcome-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            gap: 16px;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .claude-logo {
            animation: logoFadeIn 0.5s ease-in;
            cursor: pointer;
        }

        .by-text {
            color: hsl(var(--text-300));
            font-size: 14px;
            font-weight: 500;
            margin: 4px 0;
        }

        .equantic-logo {
            cursor: pointer;
        }

        /* History View Styles */
        .history-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: hsl(var(--bg-100));
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 16px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid hsl(var(--bg-300));
        }

        .history-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: hsl(var(--text-000));
        }

        .done-button {
            background: hsl(var(--accent-main-200));
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .done-button:hover {
            background: hsl(var(--accent-main-100));
            transform: translateY(-1px);
        }

        .history-search {
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid hsl(var(--bg-300));
            border-radius: 8px;
            background: hsl(var(--bg-000));
            color: hsl(var(--text-000));
            font-size: 14px;
            outline: none;
            transition: border-color 0.15s ease;
        }

        .search-input:focus {
            border-color: hsl(var(--accent-main-200));
        }

        .history-filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            gap: 16px;
        }

        .filter-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: hsl(var(--text-200));
        }

        .filter-option input[type="radio"] {
            margin-right: 6px;
            accent-color: hsl(var(--accent-main-200));
        }

        .filter-option input[type="radio"]:checked+span {
            color: hsl(var(--text-000));
            font-weight: 500;
        }

        .history-actions {
            display: flex;
            gap: 8px;
        }

        .select-all-button,
        .select-none-button {
            background: hsl(var(--accent-secondary-200));
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .select-all-button:hover,
        .select-none-button:hover {
            background: hsl(var(--accent-secondary-100));
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            border: 1px solid hsl(var(--bg-300));
            border-radius: 8px;
            padding: 8px;
            background: hsl(var(--bg-000));
        }

        .history-item {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            background: hsl(var(--bg-100));
            border: 1px solid hsl(var(--bg-300));
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
        }

        .history-item:hover {
            background: hsl(var(--bg-200));
            border-color: hsl(var(--accent-main-200));
        }

        .history-item.selected {
            background: hsl(var(--accent-main-200));
            color: white;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .history-item-date {
            font-size: 11px;
            color: hsl(var(--text-300));
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .history-item-favorite {
            font-size: 16px;
            color: hsl(var(--text-300));
            cursor: pointer;
        }

        .history-item-title {
            font-size: 13px;
            font-weight: 500;
            color: hsl(var(--text-000));
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .history-item-meta {
            display: flex;
            gap: 12px;
            font-size: 11px;
            color: hsl(var(--text-300));
        }

        .history-footer {
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid hsl(var(--bg-300));
        }

        .delete-all-button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            width: 100%;
        }

        .delete-all-button:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .claude-logo svg {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(.4, 0, .2, 1);
            transition-duration: .15s;
        }

        .claude-logo:hover svg path {
            fill: hsl(var(--accent-main-100));
            transform: scale(1.05);
        }

        .claude-logo svg path {
            transition: all 0.15s cubic-bezier(.4, 0, .2, 1);
        }

        @keyframes logoFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Claude official transition classes */
        .transition-colors {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(.4, 0, .2, 1);
            transition-duration: .15s;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 300;
            color: hsl(var(--text-000));
            margin: 0;
            text-align: center;
        }

        .welcome-info {
            color: hsl(var(--accent-main-200));
            cursor: pointer;
            font-size: 18px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .welcome-info:hover {
            opacity: 1;
        }

        /* Recent Tasks Section */
        .recent-tasks-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            margin-top: 20px;
            min-height: 0;
            /* Allow flex item to shrink */
            overflow: hidden;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            cursor: pointer;
            user-select: none;
            color: hsl(var(--text-400));
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .section-header:hover {
            background: hsl(var(--bg-200));
            border-radius: 4px;
        }

        .section-arrow {
            font-size: 10px;
            transition: transform 0.2s;
        }

        .section-arrow.collapsed {
            transform: rotate(-90deg);
        }

        .section-icon {
            font-size: 14px;
        }

        .recent-tasks-list {
            margin: 8px 0;
        }

        .task-item {
            padding: 12px;
            margin: 4px 0;
            background: hsl(var(--bg-100));
            border: 1px solid hsl(var(--bg-300));
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-item:hover {
            background: hsl(var(--bg-200));
            transform: translateX(2px);
        }

        .task-date {
            font-size: 11px;
            color: hsl(var(--text-400));
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .task-title {
            font-size: 14px;
            color: hsl(var(--text-000));
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .task-stats {
            font-size: 11px;
            color: hsl(var(--text-400));
            display: flex;
            gap: 12px;
        }

        .task-tokens {
            display: flex;
            gap: 4px;
        }

        .view-all-history {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--vscode-button-border);
            color: var(--vscode-foreground);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
            transition: all 0.2s;
        }

        .view-all-history:hover {
            background: var(--vscode-button-hoverBackground);
        }

        .empty-tasks {
            text-align: center;
            padding: 40px 20px;
            color: var(--vscode-descriptionForeground);
            font-size: 13px;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            justify-content: flex-start;
            margin: 12px 0;
            animation: fadeIn 0.3s ease-in;
        }

        .typing-bubble {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--vscode-input-background);
            border: 1px solid var(--vscode-input-border);
            border-radius: 18px 18px 18px 4px;
            padding: 12px 16px;
            max-width: 200px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .typing-avatar {
            font-size: 16px;
            flex-shrink: 0;
        }

        .typing-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
            align-items: center;
            height: 16px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: var(--vscode-editor-foreground);
            border-radius: 50%;
            opacity: 0.4;
            animation: typingDots 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .typing-text {
            font-size: 10px;
            color: var(--vscode-descriptionForeground);
            opacity: 0.8;
            margin-top: 2px;
        }

        @keyframes typingDots {

            0%,
            60%,
            100% {
                opacity: 0.4;
                transform: scale(1);
            }

            30% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        /* Pulse effect for the entire bubble */
        .typing-bubble {
            animation: typingBubblePulse 2s infinite ease-in-out;
        }

        @keyframes typingBubblePulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        /* Permission Mode Toggle */
        .permission-mode-toggle {
            display: flex;
            gap: 2px;
            background: var(--vscode-input-background);
            border: 1px solid var(--vscode-input-border);
            border-radius: 6px;
            padding: 2px;
            margin-right: 8px;
        }

        .mode-button {
            display: flex;
            align-items: center;
            gap: 4px;
            background: transparent;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            color: var(--vscode-foreground);
            font-size: 11px;
            font-weight: 500;
            min-width: 50px;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .mode-button:hover {
            background: var(--vscode-toolbar-hoverBackground);
        }

        .mode-button.active {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
        }

        .mode-button.active:hover {
            background: var(--vscode-button-hoverBackground);
        }

        .mode-icon {
            font-size: 12px;
        }

        .mode-text {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Responsive adjustments */
        @media (max-width: 400px) {
            .mode-text {
                display: none;
            }
        }
    </style>
</head>

<body data-theme="claude">
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-content">
            <div class="logo-section">
                <div class="claude-logo transition-colors">
                    <svg overflow="visible" width="80" height="80" viewBox="0 0 100 101" fill="none"
                        xmlns="http://www.w3.org/2000/svg" role="presentation">
                        <path
                            d="M96.0000 40.0000 L99.5002 42.0000 L99.5002 43.5000 L98.5000 47.0000 L56.0000 57.0000 L52.0040 47.0708 L96.0000 40.0000 M96.0000 40.0000 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(330deg) scaleY(1.11684) rotate(-330deg);">
                        </path>
                        <path
                            d="M80.1032 10.5903 L84.9968 11.6171 L86.2958 13.2179 L87.5346 17.0540 L87.0213 19.5007 L58.5000 58.5000 L49.0000 49.0000 L75.3008 14.4873 L80.1032 10.5903 M80.1032 10.5903 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(300deg) scaleY(1.09518) rotate(-300deg);">
                        </path>
                        <path
                            d="M55.5002 4.5000 L58.5005 2.5000 L61.0002 3.5000 L63.5002 7.0000 L56.6511 48.1620 L52.0005 45.0000 L50.0005 39.5000 L53.5003 8.5000 L55.5002 4.5000 M55.5002 4.5000 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(270deg) scaleY(1.09) rotate(-270deg);">
                        </path>
                        <path
                            d="M23.4253 5.1588 L26.5075 1.2217 L28.5175 0.7632 L32.5063 1.3458 L34.4748 2.8868 L48.8202 34.6902 L54.0089 49.8008 L47.9378 53.1760 L24.8009 11.1886 L23.4253 5.1588 M23.4253 5.1588 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(240deg) scaleY(1.015) rotate(-240deg);">
                        </path>
                        <path
                            d="M8.4990 27.0019 L7.4999 23.0001 L10.5003 19.5001 L14.0003 20.0001 L15.0003 20.0001 L36.0000 35.5000 L42.5000 40.5000 L51.5000 47.5000 L46.5000 56.0000 L42.0002 52.5000 L39.0001 49.5000 L10.0000 29.0001 L8.4990 27.0019 M8.4990 27.0019 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(210deg) scaleY(0.985) rotate(-210deg);">
                        </path>
                        <path
                            d="M2.5003 53.0000 L0.2370 50.5000 L0.2373 48.2759 L2.5003 47.5000 L28.0000 49.0000 L53.0000 51.0000 L52.1885 55.9782 L4.5000 53.5000 L2.5003 53.0000 M2.5003 53.0000 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(180deg) scaleY(0.955) rotate(-180deg);">
                        </path>
                        <path
                            d="M17.5002 79.0264 L12.5005 79.0264 L10.5124 76.7369 L10.5124 74.0000 L19.0005 68.0000 L53.5082 46.0337 L57.0005 52.0000 L17.5002 79.0264 M17.5002 79.0264 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(150deg) scaleY(0.94) rotate(-150deg);">
                        </path>
                        <path
                            d="M27.0004 92.9999 L25.0003 93.4999 L22.0003 91.9999 L22.5004 89.4999 L52.0003 50.5000 L56.0004 55.9999 L34.0003 85.0000 L27.0004 92.9999 M27.0004 92.9999 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(120deg) scaleY(0.997) rotate(-120deg);">
                        </path>
                        <path
                            d="M51.9998 98.0000 L50.5002 100.0000 L47.5002 101.0000 L45.0001 99.0000 L43.5000 96.0000 L51.0003 55.4999 L55.5001 55.9999 L51.9998 98.0000 M51.9998 98.0000 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(90deg) scaleY(1.10649) rotate(-90deg);">
                        </path>
                        <path
                            d="M77.5007 86.9997 L77.5007 90.9997 L77.0006 92.4997 L75.0004 93.4997 L71.5006 93.0339 L47.4669 57.2642 L56.9998 50.0002 L64.9994 64.5004 L65.7507 69.7497 L77.5007 86.9997 M77.5007 86.9997 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(60deg) scaleY(1.03816) rotate(-60deg);">
                        </path>
                        <path
                            d="M89.0008 80.9991 L89.5008 83.4991 L88.0008 85.4991 L86.5007 84.9991 L78.0007 78.9991 L65.0007 67.4991 L55.0007 60.4991 L58.0000 51.0000 L62.9999 54.0001 L66.0007 59.4991 L89.0008 80.9991 M89.0008 80.9991 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(30deg) scaleY(1.22482) rotate(-30deg);">
                        </path>
                        <path
                            d="M82.5003 55.5000 L95.0003 56.5000 L98.0003 58.5000 L100.0000 61.5000 L100.0000 63.6587 L94.5003 66.0000 L66.5005 59.0000 L55.0003 58.5000 L58.0000 48.0000 L66.0005 54.0000 L82.5003 55.5000 M82.5003 55.5000 "
                            fill="#D97757"
                            style="transform-origin: 50px 50px; transform: rotate(0deg) scaleY(1.12351) rotate(0deg);">
                        </path>
                    </svg>
                </div>

                <div class="by-text">by</div>

                <div class="equantic-logo transition-colors">
                    <svg width="120" height="32" viewBox="0 0 322 86" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M-1957.536,77.2a27.811,27.811,0,0,1-3.319-.2,27.789,27.789,0,0,1-3.224-.585,28.285,28.285,0,0,1-3.111-.951,29.249,29.249,0,0,1-2.983-1.3,31.272,31.272,0,0,1-5.515-3.559,34.7,34.7,0,0,1-4.8-4.713,38.243,38.243,0,0,1-3.964-5.713,41.383,41.383,0,0,1-2.993-6.557,43.867,43.867,0,0,1-1.892-7.245c-.217-1.26-.382-2.549-.492-3.832-.111-1.3-.167-2.63-.167-3.947s.056-2.644.167-3.947c.11-1.283.275-2.573.492-3.832a43.875,43.875,0,0,1,1.892-7.245,41.363,41.363,0,0,1,2.993-6.557,38.247,38.247,0,0,1,3.964-5.713,34.7,34.7,0,0,1,4.8-4.713,31.272,31.272,0,0,1,5.515-3.559,29.247,29.247,0,0,1,2.983-1.3,28.283,28.283,0,0,1,3.111-.951A27.789,27.789,0,0,1-1960.855.2a27.81,27.81,0,0,1,3.319-.2,27.812,27.812,0,0,1,3.319.2,27.783,27.783,0,0,1,3.223.585,28.3,28.3,0,0,1,3.111.951,29.247,29.247,0,0,1,2.983,1.3,31.267,31.267,0,0,1,5.515,3.559,34.694,34.694,0,0,1,4.8,4.713,38.232,38.232,0,0,1,3.964,5.713,41.353,41.353,0,0,1,2.993,6.557,43.889,43.889,0,0,1,1.892,7.245c.217,1.261.382,2.551.492,3.832.111,1.3.168,2.63.168,3.947s-.056,2.644-.168,3.947c-.109,1.282-.275,2.571-.492,3.832a43.889,43.889,0,0,1-1.892,7.245,41.352,41.352,0,0,1-2.993,6.557c-.289.508-.593,1.017-.9,1.511a15.684,15.684,0,0,0-.59-2.492c-.135-.416-.29-.832-.46-1.235.159-.416.311-.84.453-1.261a35.2,35.2,0,0,0,1.372-5.556,37.227,37.227,0,0,0,.479-5.965,37.227,37.227,0,0,0-.479-5.965,35.187,35.187,0,0,0-1.372-5.556,32.644,32.644,0,0,0-2.172-5.028,29.409,29.409,0,0,0-2.876-4.381,25.888,25.888,0,0,0-3.486-3.614,22.582,22.582,0,0,0-4-2.729,20.113,20.113,0,0,0-4.421-1.725,19.072,19.072,0,0,0-4.747-.6,19.071,19.071,0,0,0-4.747.6,20.111,20.111,0,0,0-4.421,1.725,22.571,22.571,0,0,0-4,2.729,25.894,25.894,0,0,0-3.486,3.614,29.409,29.409,0,0,0-2.876,4.381,32.624,32.624,0,0,0-2.172,5.028,35.2,35.2,0,0,0-1.372,5.556,37.192,37.192,0,0,0-.479,5.965,37.192,37.192,0,0,0,.479,5.965,35.194,35.194,0,0,0,1.372,5.556,32.618,32.618,0,0,0,2.172,5.028,29.4,29.4,0,0,0,2.876,4.381,25.892,25.892,0,0,0,3.486,3.614,22.577,22.577,0,0,0,4,2.729,20.112,20.112,0,0,0,4.421,1.725,19.148,19.148,0,0,0,3.137.533c0,.117,0,.238,0,.359,0,.68.025,1.366.075,2.042C-1956.08,77.169-1956.814,77.2-1957.536,77.2Z"
                            transform="translate(1990 0)" fill="hsl(var(--accent-main-200))" />
                        <path
                            d="M22.045,21.038l-.377,1.938q-8,5.587-13.64,5.587a7.4,7.4,0,0,1-5.8-2.5A9.372,9.372,0,0,1,0,19.586Q0,12.5,5.436,6.248T17.037,0a4.688,4.688,0,0,1,3.624,1.508,5.569,5.569,0,0,1,1.384,3.92q0,4.825-4.932,8.292A19.952,19.952,0,0,1,5.335,17.188L5.31,18.32q0,7.348,5.385,7.348Q15.351,25.669,22.045,21.038ZM5.385,15.653q5.637-.453,8.808-2.907a7.674,7.674,0,0,0,3.171-6.354q0-3.85-2.793-3.85-3.02,0-5.838,4.014A18.967,18.967,0,0,0,5.385,15.653Z"
                            transform="translate(32.497 60.279) rotate(-17)" fill="#80b85c" />
                        <path
                            d="M-53.3-19.273a19.772,19.772,0,0,0-.864-6.151,12.584,12.584,0,0,0-2.391-4.393,9.577,9.577,0,0,0-3.63-2.622,12.012,12.012,0,0,0-4.609-.864,12.012,12.012,0,0,0-4.609.864,9.577,9.577,0,0,0-3.63,2.622,12.584,12.584,0,0,0-2.391,4.393,19.772,19.772,0,0,0-.864,6.151,19.772,19.772,0,0,0,.864,6.151A12.428,12.428,0,0,0-73.03-8.743,9.787,9.787,0,0,0-69.4-6.122a11.839,11.839,0,0,0,4.609.879,11.839,11.839,0,0,0,4.609-.879,9.787,9.787,0,0,0,3.63-2.622,12.428,12.428,0,0,0,2.391-4.379A19.772,19.772,0,0,0-53.3-19.273Zm.778,14.347q.72-.2,1.642-.375t1.916-.288q.994-.115,1.988-.173t1.945-.058h.547V.317q-1.527-.144-3.687-.23T-52.749,0Q-54.563,0-56,.086t-2.9.187q-1.455.1-3.025.187t-3.068.086a20.614,20.614,0,0,1-7.98-1.44,15.983,15.983,0,0,1-5.819-4.062,17.434,17.434,0,0,1-3.572-6.266,25.438,25.438,0,0,1-1.21-8.052,24.892,24.892,0,0,1,1.253-8.081,17.859,17.859,0,0,1,3.659-6.323,16.449,16.449,0,0,1,5.906-4.12,20.418,20.418,0,0,1,7.966-1.469A20.418,20.418,0,0,1-56.825-37.8a16.622,16.622,0,0,1,5.906,4.091,17.647,17.647,0,0,1,3.659,6.237,24,24,0,0,1,1.253,7.908,21.988,21.988,0,0,1-.432,4.379,19.039,19.039,0,0,1-1.253,3.976,16.681,16.681,0,0,1-2.06,3.443,13.918,13.918,0,0,1-2.823,2.751ZM-25.524.72A15.139,15.139,0,0,1-32.5-.706a9.978,9.978,0,0,1-4.177-3.846A10.312,10.312,0,0,1-37.782-7.4a15.351,15.351,0,0,1-.36-3.457V-27.916h6.828v16.334a12.755,12.755,0,0,0,.2,2.434,6.293,6.293,0,0,0,.6,1.772,4.377,4.377,0,0,0,1.959,1.887,6.827,6.827,0,0,0,3.025.619A6.682,6.682,0,0,0-22.37-5.56a4.427,4.427,0,0,0,1.973-2.1,8.748,8.748,0,0,0,.663-3.774V-27.916h6.828v17.055a12.6,12.6,0,0,1-1.181,5.733A9.565,9.565,0,0,1-15.8-2.722A10.037,10.037,0,0,1-18.279-.879A13.062,13.062,0,0,1-21.506.3A17.816,17.816,0,0,1-25.524.72ZM10.717-2.967H10.6A13.006,13.006,0,0,1,9.219-1.729a13,13,0,0,1-1.844,1.2,10.773,10.773,0,0,1-2.3.907A10.37,10.37,0,0,1,2.333.72,10.936,10.936,0,0,1-1.383.1,8.4,8.4,0,0,1-4.35-1.685,8.286,8.286,0,0,1-6.295-4.509,9.354,9.354,0,0,1-7-8.21a9.549,9.549,0,0,1,.821-4.033,8.6,8.6,0,0,1,2.29-3.025A10.126,10.126,0,0,1-.375-17.156,14.918,14.918,0,0,1,4.148-17.8a22.459,22.459,0,0,1,3.342.23,23.345,23.345,0,0,1,2.679.547v-1.124a5.46,5.46,0,0,0-.331-1.887A4.231,4.231,0,0,0,8.772-21.65a5.243,5.243,0,0,0-1.916-1.124,8.7,8.7,0,0,0-2.881-.418,19.071,19.071,0,0,0-4.148.461,32.583,32.583,0,0,0-4.494,1.383v-5.33A22.429,22.429,0,0,1-.2-28.088a25.778,25.778,0,0,1,4.955-.519,17.219,17.219,0,0,1,5.344.749,11.222,11.222,0,0,1,3.832,2.06,8.321,8.321,0,0,1,2.3,3.1A9.792,9.792,0,0,1,17-18.812V-8.3q0,2.766.058,4.753T17.17,0H11ZM10.169-11.9q-.979-.23-2.247-.418A17.521,17.521,0,0,0,5.358-12.5a6.929,6.929,0,0,0-3.961.994A3.429,3.429,0,0,0-.058-8.47,3.863,3.863,0,0,0,.274-6.813a3.293,3.293,0,0,0,.893,1.167,3.806,3.806,0,0,0,1.311.691,5.358,5.358,0,0,0,1.584.23A6.85,6.85,0,0,0,6.021-5a8.988,8.988,0,0,0,1.7-.691,8.242,8.242,0,0,0,1.4-.936,9.739,9.739,0,0,0,1.052-1.008ZM30.94-24.026h.115a10.25,10.25,0,0,1,1.527-1.7,10.522,10.522,0,0,1,2.1-1.469,12.388,12.388,0,0,1,2.607-1.023,11.508,11.508,0,0,1,3.039-.389,12.49,12.49,0,0,1,2.953.346,8.845,8.845,0,0,1,2.607,1.08,7.979,7.979,0,0,1,2.089,1.9,8.935,8.935,0,0,1,1.426,2.78,9.177,9.177,0,0,1,.389,1.945q.1,1.052.1,2.434V0H43.069V-17.055a18.461,18.461,0,0,0-.086-1.93,5.671,5.671,0,0,0-.317-1.412,3.528,3.528,0,0,0-1.57-1.9,5.238,5.238,0,0,0-2.55-.576,8.273,8.273,0,0,0-3.817.936,9.851,9.851,0,0,0-3.241,2.722V0H24.66V-27.916h5.646Zm43.5,24A17.162,17.162,0,0,1,71.69.519a23.917,23.917,0,0,1-2.982.2A12.646,12.646,0,0,1,62.961-.418a6.52,6.52,0,0,1-3.155-3.27,10.633,10.633,0,0,1-.663-4.148V-22.3H53.93v-5.618h5.214v-7.807h6.828v7.807h8.066V-22.3H65.972V-8.729a4.585,4.585,0,0,0,.49,2.391q.864,1.325,3.428,1.325A14.793,14.793,0,0,0,72.238-5.2a20.192,20.192,0,0,0,2.2-.475Zm5.5-27.887h6.828V0H79.944Zm-.173-13.8h7.173v7.4H79.771ZM114.543-.6a17.258,17.258,0,0,1-3.169.936,19.374,19.374,0,0,1-3.947.389,17.929,17.929,0,0,1-5.646-.864A12.749,12.749,0,0,1,97.2-2.766a12.158,12.158,0,0,1-3.083-4.451,16.265,16.265,0,0,1-1.124-6.295,16.764,16.764,0,0,1,1.3-6.914,13.411,13.411,0,0,1,3.356-4.681,13.314,13.314,0,0,1,4.638-2.65,16.177,16.177,0,0,1,5.085-.85,19.1,19.1,0,0,1,3.6.331,16.546,16.546,0,0,1,3.14.907v5.56a15.8,15.8,0,0,0-2.694-.879,13.538,13.538,0,0,0-3.068-.331,9.778,9.778,0,0,0-3.14.5,7.086,7.086,0,0,0-2.65,1.6,7.609,7.609,0,0,0-1.829,2.9,12.346,12.346,0,0,0-.677,4.336,11.371,11.371,0,0,0,.519,3.471,7.842,7.842,0,0,0,1.512,2.78,7.3,7.3,0,0,0,2.535,1.858,8.688,8.688,0,0,0,3.644.706,14.283,14.283,0,0,0,3.4-.375,21.071,21.071,0,0,0,2.881-.922Z"
                            transform="translate(202 59)" fill="hsl(var(--accent-main-200))" />
                        <path
                            d="M-98.583-4.782a22.612,22.612,0,0,0,4.148-.4,32.1,32.1,0,0,0,4.379-1.152V-.893A20.44,20.44,0,0,1-94.118.2,30.429,30.429,0,0,1-99.793.72a20.355,20.355,0,0,1-5.632-.763,12.25,12.25,0,0,1-4.653-2.463,11.855,11.855,0,0,1-3.155-4.408,16.57,16.57,0,0,1-1.167-6.568,18.519,18.519,0,0,1,1.095-6.655,13.544,13.544,0,0,1,2.938-4.725,12.091,12.091,0,0,1,4.22-2.809,13.287,13.287,0,0,1,4.912-.936,14.273,14.273,0,0,1,4.883.807,9.81,9.81,0,0,1,3.86,2.535,11.849,11.849,0,0,1,2.535,4.451,20.422,20.422,0,0,1,.907,6.439q-.029,1.44-.086,2.449h-18.293a8.368,8.368,0,0,0,.864,3.3,6.355,6.355,0,0,0,1.887,2.218,7.771,7.771,0,0,0,2.722,1.239A13.873,13.873,0,0,0-98.583-4.782Zm-2.737-18.5a5.344,5.344,0,0,0-2.3.475,5.408,5.408,0,0,0-1.743,1.3,6.327,6.327,0,0,0-1.167,1.916,9.23,9.23,0,0,0-.576,2.333h10.976a8.016,8.016,0,0,0-.331-2.333,5.739,5.739,0,0,0-.979-1.916,4.635,4.635,0,0,0-1.613-1.3A5.062,5.062,0,0,0-101.32-23.277Z"
                            transform="translate(202 59)" fill="#80b85c" />
                    </svg>
                </div>
            </div>
            <h2 class="welcome-title">What can I do for you?</h2>
            <div class="welcome-info">ⓘ</div>
        </div>

        <div class="recent-tasks-section">
            <div class="section-header" id="recentTasksToggle">
                <span class="section-arrow">▼</span>
                <span class="section-icon">💬</span>
                <span class="section-title">RECENT TASKS</span>
            </div>
            <div id="recentTasksList" class="recent-tasks-list">
                <!-- Tasks will be populated here -->
            </div>
            <button class="view-all-history" id="viewAllHistory">View all history</button>
        </div>
    </div>

    <div id="chatContainer" class="chat-container" style="display: none;">
        <div class="messages-container">
            <!-- Messages will be inserted here -->

            <!-- Typing indicator -->
            <div id="typingIndicator" class="typing-indicator" style="display: none;">
                <div class="typing-bubble">
                    <div class="typing-avatar">🤖</div>
                    <div class="typing-content">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <div class="typing-text">Claude está pensando...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="workspaceContext" class="workspace-context" style="display: none;">
        <!-- Workspace context will be inserted here -->
    </div>

    <!-- Full History View -->
    <div id="historyView" class="history-view" style="display: none;">
        <div class="history-header">
            <h2>History</h2>
            <button class="done-button" id="historyDoneButton">Done</button>
        </div>

        <div class="history-search">
            <input type="text" id="historySearch" class="search-input" placeholder="🔍 Fuzzy search history...">
        </div>

        <div class="history-filters">
            <div class="filter-group">
                <label class="filter-option">
                    <input type="radio" name="sortBy" value="newest" checked>
                    <span>Newest</span>
                </label>
                <label class="filter-option">
                    <input type="radio" name="sortBy" value="oldest">
                    <span>Oldest</span>
                </label>
                <label class="filter-option">
                    <input type="radio" name="sortBy" value="most-tokens">
                    <span>Most Tokens</span>
                </label>
                <label class="filter-option">
                    <input type="radio" name="sortBy" value="workspace">
                    <span>Workspace</span>
                </label>
            </div>

            <div class="history-actions">
                <button class="select-all-button" id="selectAllHistory">Select All</button>
                <button class="select-none-button" id="selectNoneHistory">Select None</button>
            </div>
        </div>

        <div class="history-list" id="historyList">
            <!-- History items will be inserted here -->
        </div>

        <div class="history-footer">
            <button class="delete-all-button" id="deleteAllHistory">
                Delete All History (calculating...)
            </button>
        </div>
    </div>

    <!-- Fixed Input Area at Bottom -->
    <div class="input-area">
        <!-- Action Buttons Row -->
        <div class="footer-actions">
            <div class="action-left">
                <button class="action-button transition-colors" id="newChatButton" title="New Chat">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>

                <button class="action-button transition-colors" id="attachButton" title="Attach Files">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66L9.64 16.2a2 2 0 0 1-2.83-2.83l8.49-8.49">
                        </path>
                    </svg>
                </button>
            </div>

            <div class="action-right">
                <div class="permission-mode-toggle">
                    <button class="mode-button transition-colors" id="planModeButton" data-mode="plan"
                        title="Plan Mode - Claude will plan actions without executing">
                        <span class="mode-icon">📋</span>
                        <span class="mode-text">Plan</span>
                    </button>
                    <button class="mode-button active transition-colors" id="actModeButton" data-mode="act"
                        title="Act Mode - Claude will execute actions directly">
                        <span class="mode-icon">⚡</span>
                        <span class="mode-text">Act</span>
                    </button>
                </div>

                <div class="model-selector">
                    <select id="modelSelect" class="model-dropdown transition-colors">
                        <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                        <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                        <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Message Input -->
        <div class="input-container">
            <textarea id="messageInput" class="message-input transition-colors"
                placeholder="Pergunte qualquer coisa ao Claude..." rows="1"></textarea>
            <button id="sendButton" class="send-button transition-colors">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22,2 15,22 11,13 2,9"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <script>
        console.log('🚀 Starting Claude Code Extension JavaScript...');

        const vscode = acquireVsCodeApi();
        let isProcessing = false;

        console.log('✅ VS Code API acquired successfully');

        // DOM elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const chatContainer = document.getElementById('chatContainer');
        const messagesContainer = document.querySelector('.messages-container');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const workspaceContext = document.getElementById('workspaceContext');
        const typingIndicator = document.getElementById('typingIndicator');
        const recentTasksList = document.getElementById('recentTasksList');
        const recentTasksToggle = document.getElementById('recentTasksToggle');
        const viewAllHistory = document.getElementById('viewAllHistory');

        // Permission mode elements (with null checks)
        const planModeButton = document.getElementById('planModeButton');
        const actModeButton = document.getElementById('actModeButton');

        // History view elements
        const historyView = document.getElementById('historyView');
        const historyDoneButton = document.getElementById('historyDoneButton');
        const historySearch = document.getElementById('historySearch');
        const historyList = document.getElementById('historyList');

        // Footer action buttons
        const newChatButton = document.getElementById('newChatButton');
        const historyButton = document.getElementById('historyButton');
        const searchButton = document.getElementById('searchButton');
        const modelSelect = document.getElementById('modelSelect');
        const uploadButton = document.getElementById('uploadButton');

        // Message handling
        window.addEventListener('message', event => {
            const message = event.data;

            switch (message.type) {
                case 'streamingMessage':
                    hideTypingIndicator();
                    handleStreamingMessage(message.data);
                    break;
                case 'streamingComplete':
                    hideTypingIndicator();
                    handleStreamingComplete(message.data);
                    break;
                case 'streamingError':
                    hideTypingIndicator();
                    handleStreamingError(message.error);
                    break;
                case 'workspaceContext':
                    updateWorkspaceContext(message.data);
                    break;
                case 'showTyping':
                    showTypingIndicator();
                    break;
                case 'hideTyping':
                    hideTypingIndicator();
                    break;
                case 'loadRecentTasks':
                    console.log('🎯 JavaScript: Received loadRecentTasks message:', message);
                    loadRecentTasks(message.tasks);
                    break;
                case 'loadAllHistory':
                    loadAllHistory(message.tasks);
                    break;
                case 'startChat':
                    startChatSession(message.taskId);
                    break;
                case 'permissionModeUpdate':
                    updatePermissionModeUI(message.mode);
                    break;
            }
        });

        // Send message
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text || isProcessing) return;

            // Add user message
            addMessage({
                role: 'user',
                content: text,
                timestamp: Date.now()
            });

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // Show typing indicator immediately
            showTypingIndicator();

            // Send to extension with streaming enabled
            vscode.postMessage({
                type: 'sendMessage',
                message: text,
                useStreaming: true
            });

            isProcessing = true;
            updateSendButton();
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);

        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        messageInput.addEventListener('input', (e) => {
            e.target.style.height = 'auto';
            e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
        });

        // Core functions
        function addMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + message.role;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = message.content;

            const metaDiv = document.createElement('div');
            metaDiv.className = 'message-meta';
            const timeStr = new Date(message.timestamp).toLocaleTimeString();
            metaDiv.textContent = (message.role === 'user' ? 'You' : 'Claude') + ' • ' + timeStr;

            messageDiv.appendChild(metaDiv);
            messageDiv.appendChild(contentDiv);

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function handleStreamingMessage(data) {
            // Create or update streaming card based on content type
            createIntelligentMessageCard(data.content, data.type);
        }

        function handleStreamingComplete(data) {
            isProcessing = false;
            updateSendButton();

            if (data.finalMessage) {
                // Add final message if needed
                addMessage(data.finalMessage);
            }
        }

        function handleStreamingError(error) {
            isProcessing = false;
            updateSendButton();

            const errorDiv = document.createElement('div');
            errorDiv.className = 'message assistant';
            errorDiv.innerHTML = '<div class="message-meta">Error</div><div style="color: var(--vscode-errorForeground);">❌ ' + error + '</div>';
            messagesContainer.appendChild(errorDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function updateSendButton() {
            sendButton.disabled = isProcessing;
            sendButton.textContent = isProcessing ? '⏳' : '➤';
        }

        function updateWorkspaceContext(context) {
            if (!context) return;

            let contextHTML = '';

            if (context.rootPath) {
                contextHTML += '<div class="context-item"><span>📁</span>Workspace: ' + context.rootPath.split('/').pop() + '</div>';
            }

            if (context.currentFile) {
                contextHTML += '<div class="context-item"><span>📄</span>Current: ' + context.currentFile.path.split('/').pop() + '</div>';
            }

            if (context.openFiles && context.openFiles.length > 0) {
                contextHTML += '<div class="context-item"><span>📂</span>' + context.openFiles.length + ' files open</div>';
            }

            if (contextHTML) {
                workspaceContext.innerHTML = contextHTML;
                workspaceContext.style.display = 'flex';
            }
        }

        // Simple intelligent message cards
        function createIntelligentMessageCard(content, messageType) {
            const cardType = analyzeContentType(content, messageType);

            const messageCard = document.createElement('div');
            messageCard.className = 'streaming-card ' + cardType.type;

            const cardHeader = document.createElement('div');
            cardHeader.className = 'card-header';
            cardHeader.innerHTML =
                '<div class="card-icon">' + cardType.icon + '</div>' +
                '<div class="card-title">' + cardType.title + '</div>' +
                '<div class="card-timestamp">' + new Date().toLocaleTimeString() + '</div>';

            const cardContent = document.createElement('div');
            cardContent.className = 'card-content';

            // Format content based on type
            let formattedContent = content;
            if (cardType.type === 'code-snippet') {
                formattedContent = formatCodeSnippet(content);
            } else {
                formattedContent = processBasicContent(content);
            }

            cardContent.innerHTML = formattedContent;

            messageCard.appendChild(cardHeader);
            messageCard.appendChild(cardContent);

            messagesContainer.appendChild(messageCard);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            return messageCard;
        }

        function analyzeContentType(content, messageType) {
            const text = String(content).toLowerCase();

            // Code detection
            if (hasCodeBlocks(content) || isCodeSnippet(content)) {
                const language = detectLanguage(content);
                return {
                    type: 'code-snippet',
                    icon: '💻',
                    title: 'Code Snippet',
                    language: language
                };
            }

            // Other content types
            if (text.includes('todo') && text.includes('status')) {
                return { type: 'todo-planning', icon: '📋', title: 'Planning' };
            }

            if (text.includes('exploring') || text.includes('files')) {
                return { type: 'file-exploration', icon: '📁', title: 'File Explorer' };
            }

            if (text.includes('analyzing') || text.includes('let me')) {
                return { type: 'thinking', icon: '💭', title: 'Thinking' };
            }

            return { type: 'text-message', icon: '💬', title: 'Claude Response' };
        }

        function hasCodeBlocks(text) {
            return text.indexOf('```') >= 0;
        }

        function isCodeSnippet(text) {
            if (hasCodeBlocks(text)) return true;

            const codeIndicators = [
                'function(', 'function ', 'const ', 'let ', 'def ', 'class ',
                'import ', 'console.log', 'print(', 'return ', 'public class'
            ];

            return codeIndicators.some(indicator => text.includes(indicator));
        }

        function detectLanguage(text) {
            if (text.includes('```python')) return 'python';
            if (text.includes('```javascript') || text.includes('```js')) return 'javascript';
            if (text.includes('```typescript') || text.includes('```ts')) return 'typescript';
            if (text.includes('```csharp') || text.includes('```cs')) return 'csharp';
            if (text.includes('```html')) return 'html';
            if (text.includes('```css')) return 'css';
            if (text.includes('```json')) return 'json';

            // Content-based detection
            const lowerText = text.toLowerCase();
            if (lowerText.includes('def ') && lowerText.includes(':')) return 'python';
            if (lowerText.includes('function ') && lowerText.includes('{')) return 'javascript';
            if (lowerText.includes('public class')) return 'csharp';

            return 'code';
        }

        function formatCodeSnippet(content) {
            const language = detectLanguage(content);
            let code = content;

            // Extract code from markdown blocks
            if (content.includes('```')) {
                const start = content.indexOf('```');
                const end = content.lastIndexOf('```');
                if (start !== end) {
                    code = content.substring(start + 3, end).trim();
                    const firstNewline = code.indexOf('\n');
                    if (firstNewline > 0 && firstNewline < 20) {
                        code = code.substring(firstNewline + 1);
                    }
                }
            }

            return '<div class="code-snippet">' +
                '<div class="code-header">' +
                '<span>💻 ' + language.toUpperCase() + '</span>' +
                '<button class="copy-button" onclick="copyCode(this)" title="Copy code">📋</button>' +
                '</div>' +
                '<pre><code>' + escapeHtml(code) + '</code></pre>' +
                '</div>';
        }

        function processBasicContent(content) {
            return escapeHtml(content).replace(/\n/g, '<br>');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyCode(button) {
            const codeBlock = button.closest('.code-snippet').querySelector('code');
            const text = codeBlock.textContent;
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = '✅';
                setTimeout(() => button.textContent = '📋', 2000);
            });
        }

        // Typing indicator functions
        function showTypingIndicator() {
            if (typingIndicator) {
                typingIndicator.style.display = 'flex';
                // Smooth scroll to bottom to show the typing indicator
                setTimeout(() => {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 100);
            }
        }

        function hideTypingIndicator() {
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }
        }

        // Recent Tasks Management
        function loadRecentTasks(tasks) {
            console.log('🎯 JavaScript: loadRecentTasks called with:', tasks);

            if (!recentTasksList) {
                console.error('❌ JavaScript: recentTasksList element not found!');
                return;
            }

            if (!tasks || tasks.length === 0) {
                console.log('🎯 JavaScript: No tasks provided, showing empty message');
                recentTasksList.innerHTML = '<div class="empty-tasks">No recent tasks.<br>Start a new conversation!</div>';
                return;
            }

            console.log(`🎯 JavaScript: Loading ${tasks.length} tasks into recent tasks list`);

            recentTasksList.innerHTML = '';
            tasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.onclick = () => resumeTask(task.id);

                const date = new Date(task.timestamp);
                const dateStr = formatDate(date);
                const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                taskItem.innerHTML = `
                    <div class="task-date">${dateStr}, ${timeStr}</div>
                    <div class="task-title">${escapeHtml(task.title || task.firstMessage || 'Untitled')}</div>
                    <div class="task-stats">
                        <span>Tokens: ${task.tokenCount || '0'}</span>
                        ${task.cacheInfo ? `<span>• Cache: ${task.cacheInfo}</span>` : ''}
                    </div>
                `;

                recentTasksList.appendChild(taskItem);
            });
        }

        function formatDate(date) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            if (date.toDateString() === today.toDateString()) {
                return 'TODAY';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'YESTERDAY';
            } else {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }).toUpperCase();
            }
        }

        function resumeTask(taskId) {
            vscode.postMessage({
                type: 'resumeTask',
                taskId: taskId
            });
        }

        // History View Functions
        function showHistoryView() {
            // Request all history from the extension
            vscode.postMessage({ type: 'loadAllHistory' });

            // Show history view
            historyView.style.display = 'flex';
            welcomeScreen.style.display = 'none';
            chatContainer.style.display = 'none';
        }

        function hideHistoryView() {
            historyView.style.display = 'none';
            welcomeScreen.style.display = 'flex';
        }

        function loadAllHistory(allTasks) {
            if (!allTasks || allTasks.length === 0) {
                historyList.innerHTML = '<div class="empty-history">No history found.</div>';
                return;
            }

            historyList.innerHTML = '';

            allTasks.forEach(task => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.taskId = task.id;

                const date = new Date(task.timestamp);
                const dateStr = date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });

                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-date">${dateStr}</div>
                        <div class="history-item-favorite">☆</div>
                    </div>
                    <div class="history-item-title">${escapeHtml(task.title || task.firstMessage || 'Untitled')}</div>
                    <div class="history-item-meta">
                        <span>Tokens: ↑ ${task.tokenCount || 0} ↓ 0</span>
                        <span>Cache: 📄 ${task.cacheInfo || '0'}</span>
                    </div>
                `;

                historyItem.addEventListener('click', () => {
                    hideHistoryView();
                    startChatSession(task.id);
                });

                historyList.appendChild(historyItem);
            });
        }

        function startChatSession(taskId) {
            // Hide welcome screen and show chat
            welcomeScreen.style.display = 'none';
            chatContainer.style.display = 'flex';

            // Focus on input
            messageInput.focus();
        }

        function showWelcomeScreen() {
            welcomeScreen.style.display = 'flex';
            chatContainer.style.display = 'none';
        }

        // Toggle recent tasks
        recentTasksToggle.addEventListener('click', () => {
            const arrow = recentTasksToggle.querySelector('.section-arrow');
            const isCollapsed = arrow.classList.contains('collapsed');

            if (isCollapsed) {
                arrow.classList.remove('collapsed');
                recentTasksList.style.display = 'block';
            } else {
                arrow.classList.add('collapsed');
                recentTasksList.style.display = 'none';
            }
        });

        // View all history
        viewAllHistory.addEventListener('click', () => {
            showHistoryView();
        });

        // History view controls
        if (historyDoneButton) {
            historyDoneButton.addEventListener('click', () => {
                hideHistoryView();
            });
        }

        // Footer action handlers
        newChatButton.addEventListener('click', () => {
            vscode.postMessage({ type: 'newChat' });
        });

        historyButton.addEventListener('click', () => {
            vscode.postMessage({ type: 'toggleHistory' });
        });

        searchButton.addEventListener('click', () => {
            vscode.postMessage({ type: 'openSearch' });
        });

        modelSelect.addEventListener('change', (e) => {
            vscode.postMessage({
                type: 'changeModel',
                model: e.target.value
            });
        });

        uploadButton.addEventListener('click', () => {
            vscode.postMessage({ type: 'uploadFiles' });
        });

        // Theme detection and management
        function detectAndApplyTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const body = document.body;

            if (prefersDark) {
                body.setAttribute('data-mode', 'dark');
            } else {
                body.setAttribute('data-mode', 'light');
            }
        }

        // Apply theme on load
        detectAndApplyTheme();

        // Listen for theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', detectAndApplyTheme);

        // Permission Mode Management
        function updatePermissionModeUI(mode) {
            try {
                // Check if elements exist before manipulating them
                if (!planModeButton || !actModeButton) {
                    console.warn('⚠️ Permission mode buttons not found in DOM');
                    return;
                }

                // Remove active class from all mode buttons
                planModeButton.classList.remove('active');
                actModeButton.classList.remove('active');

                // Add active class to current mode
                if (mode === 'plan') {
                    planModeButton.classList.add('active');
                } else {
                    actModeButton.classList.add('active');
                }

                console.log(`🎯 Permission mode updated to: ${mode.toUpperCase()}`);
            } catch (error) {
                console.error('❌ Error updating permission mode UI:', error);
            }
        }

        function setPermissionMode(mode) {
            vscode.postMessage({
                type: 'setPermissionMode',
                mode: mode
            });
        }

        // Permission mode button event listeners (with safety checks)
        try {
            if (planModeButton) {
                planModeButton.addEventListener('click', () => {
                    setPermissionMode('plan');
                });
                console.log('✅ Plan mode button listener attached');
            } else {
                console.warn('⚠️ Plan mode button not found');
            }

            if (actModeButton) {
                actModeButton.addEventListener('click', () => {
                    setPermissionMode('default');
                });
                console.log('✅ Act mode button listener attached');
            } else {
                console.warn('⚠️ Act mode button not found');
            }
        } catch (error) {
            console.error('❌ Error setting up permission mode listeners:', error);
        }

        // Request initial data
        console.log('🎯 JavaScript: Requesting workspace context and recent tasks...');

        try {
            vscode.postMessage({ type: 'getWorkspaceContext' });
            console.log('✅ Sent getWorkspaceContext message');

            vscode.postMessage({ type: 'loadRecentTasks' });
            console.log('✅ Sent loadRecentTasks message');

            vscode.postMessage({ type: 'getPermissionMode' });
            console.log('✅ Sent getPermissionMode message');
        } catch (error) {
            console.error('❌ Error sending initial messages:', error);
        }

        console.log('🎉 Claude Code Extension JavaScript initialization complete!');
    </script>
</body>

</html>